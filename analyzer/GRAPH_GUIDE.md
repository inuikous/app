# 精度評価グラフ生成ガイド

## 概要

`visualize_accuracy.py`は、画像解析システムの精度を視覚的に評価するためのグラフを生成します。

## 生成されるグラフ

### 1. accuracy_summary.png
**精度サマリー（4つのグラフ）**

- **左上**: ハート角度誤差の分布（ヒストグラム）
  - X軸: 角度誤差（度）
  - Y軸: 画像数
  - 平均誤差を表示

- **右上**: 右上アルファベット角度誤差の分布（ヒストグラム）
  - X軸: 角度誤差（度）
  - Y軸: 画像数
  - 平均誤差を表示

- **左下**: 右下アルファベット角度誤差の分布（ヒストグラム）
  - X軸: 角度誤差（度）
  - Y軸: 画像数
  - 平均誤差を表示

- **右下**: 文字認識正解率（棒グラフ）
  - 右上文字と右下文字の正解率を比較
  - パーセンテージで表示

### 2. error_transition.png
**画像ごとの誤差推移（3つのグラフ）**

- **上段**: ハート角度誤差の推移
  - X軸: 画像番号
  - Y軸: 誤差（度）
  - 赤い点線: 平均誤差

- **中段**: 右上アルファベット角度誤差の推移
  - X軸: 画像番号
  - Y軸: 誤差（度）
  - 赤い点線: 平均誤差

- **下段**: 右下アルファベット角度誤差の推移
  - X軸: 画像番号
  - Y軸: 誤差（度）
  - 赤い点線: 平均誤差

### 3. error_boxplot.png
**誤差の統計分布（ボックスプロット）**

- 3つのボックスプロット（ハート、右上、右下）
- 表示内容:
  - 中央値（赤線）
  - 第1四分位数～第3四分位数（箱）
  - 最小値～最大値（ひげ）
  - 外れ値（点）

## 使用方法

### 方法1: analyze.pyから自動生成

```bash
python analyze.py \
  --input ../dataset \
  --ground-truth ../dataset/labels.csv \
  --plot
```

### 方法2: 単独で実行

```bash
python visualize_accuracy.py \
  --results outputs/analysis_results.csv \
  --ground-truth ../dataset/labels.csv \
  --output outputs/plots
```

### オプション

```
--results, -r FILE     解析結果のCSVファイル（デフォルト: outputs/analysis_results.csv）
--ground-truth, -g FILE 正解データのCSVファイル（デフォルト: ../dataset/labels.csv）
--output, -o DIR       グラフ出力ディレクトリ（デフォルト: outputs/plots）
```

## 出力される統計情報

コンソールに以下の詳細統計が表示されます：

### ハート角度誤差
- 平均誤差
- 中央値
- 最大誤差
- 最小誤差
- 標準偏差

### 右上アルファベット
- 文字認識正解率（%）
- 角度平均誤差
- 角度中央値
- 角度最大誤差
- 角度標準偏差

### 右下アルファベット
- 文字認識正解率（%）
- 角度平均誤差
- 角度中央値
- 角度最大誤差
- 角度標準偏差

### 総合評価
- 評価画像数
- 全体平均角度誤差
- 全体文字認識正解率

## グラフの見方

### ヒストグラム
- **山が右にある**: 誤差が大きい画像が多い
- **山が左にある**: 誤差が小さい画像が多い（精度が高い）
- **分布が広い**: ばらつきが大きい
- **分布が狭い**: 安定している

### 推移グラフ
- **平均線より上**: その画像は平均より精度が低い
- **平均線より下**: その画像は平均より精度が高い
- **急激な変動**: 特定の条件で精度が変わる

### ボックスプロット
- **箱が小さい**: ばらつきが少ない（安定）
- **箱が大きい**: ばらつきが大きい（不安定）
- **外れ値が多い**: 異常な画像がある
- **中央値が箱の中心**: データが対称的

## カスタマイズ

`visualize_accuracy.py`を編集して以下をカスタマイズできます：

### グラフのサイズ
```python
fig, axes = plt.subplots(2, 2, figsize=(15, 12))  # サイズを変更
```

### 色の変更
```python
colors = ['skyblue', 'lightcoral', 'lightgreen']  # お好みの色に
```

### ビンの数（ヒストグラム）
```python
ax.hist(data, bins=30, ...)  # より細かく分割
```

### DPI（解像度）
```python
plt.savefig(path, dpi=300, ...)  # より高解像度に
```

## トラブルシューティング

### フォントエラー
日本語が表示されない場合：
```python
# visualize_accuracy.py の12-13行目を編集
matplotlib.rcParams['font.sans-serif'] = ['Your Font Name']
```

### グラフが表示されない
- ファイルは保存されています（output/graphs/）
- 画像ビューアで開いてください

### メモリエラー
- DPIを下げる（150 → 100）
- 画像サイズを小さくする

## 活用例

### 1. アルゴリズム改善の評価
- 変更前後でグラフを比較
- 誤差が減っているか確認

### 2. パラメータチューニング
- 設定値を変えて複数回実行
- 最適な設定を見つける

### 3. プレゼンテーション
- グラフを報告書に添付
- 視覚的に精度を説明

### 4. 問題の特定
- 推移グラフで異常な画像を発見
- ボックスプロットで外れ値を確認

## 依存パッケージ

```
matplotlib>=3.7.0
numpy>=1.24.0
```

インストール:
```bash
pip install matplotlib numpy
```

## 出力例

```
============================================================
精度評価グラフ生成
============================================================
解析結果: ../output/analysis_results.csv
正解データ: ../dataset_generator/dataset/labels.csv
出力先: ../output/graphs
============================================================

データを読み込んでいます...
✓ 100件の解析結果を読み込みました
✓ 100件の正解データを読み込みました

精度を分析しています...
✓ 100件のデータを分析しました

グラフを生成しています...
保存: ../output/graphs\accuracy_summary.png
保存: ../output/graphs\error_transition.png
保存: ../output/graphs\error_boxplot.png

============================================================
詳細統計レポート
============================================================
[統計情報が表示されます]
```

---

グラフを活用して、システムの精度向上にお役立てください！
